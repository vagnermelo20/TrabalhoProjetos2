{% extends 'main/base.html' %}
{% load static %}

{% block title %}{% if form.instance.pk %}Editar{% else %}Novo{% endif %} Aluno{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.14.0-beta3/dist/css/bootstrap-select.min.css">
<style>
    .form-section {
        background-color: #f8f9fa;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 30px;
        box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
    }
    .section-title {
        background-color: #0d6efd;
        color: white;
        padding: 12px 20px;
        margin: -20px -20px 20px -20px;
        border-radius: 8px 8px 0 0;
        font-size: 1.2rem;
        font-weight: 600;
    }
    .form-label {
        font-weight: 500;
    }
    .form-check-label {
        font-weight: normal;
    }
    .btn-nav {
        min-width: 120px;
    }
    .tab-content {
        padding-top: 30px;
    }
    .form-navigation {
        position: sticky;
        bottom: 0;
        background-color: white;
        padding: 15px 0;
        box-shadow: 0 -5px 10px rgba(0,0,0,0.05);
        z-index: 100;
    }
    .required-field label:after {
        content: " *";
        color: red;
    }
</style>
{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center">
            <h1>{% if form.instance.pk %}Editar{% else %}Cadastrar Novo{% endif %} Aluno</h1>
            <a href="{% url 'aluno-list' %}" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> Voltar para Lista
            </a>
        </div>
    </div>
</div>

<form method="post" enctype="multipart/form-data" class="needs-validation" id="alunoForm" novalidate>
    {% csrf_token %}
    
    {% if form.errors %}
    <div class="alert alert-danger">
        <strong>Ocorreram erros ao salvar o formulário.</strong>
        <ul>
            {% for field in form %}
                {% for error in field.errors %}
                    <li>{{ field.label }}: {{ error }}</li>
                {% endfor %}
            {% endfor %}
            {% for error in form.non_field_errors %}
                <li>{{ error }}</li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}

    <ul class="nav nav-pills mb-4" id="formTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="identificacao-tab" data-bs-toggle="pill" data-bs-target="#identificacao" type="button" role="tab">Identificação</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="responsavel-tab" data-bs-toggle="pill" data-bs-target="#responsavel" type="button" role="tab">Responsável</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="endereco-tab" data-bs-toggle="pill" data-bs-target="#endereco" type="button" role="tab">Endereço</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="educacao-tab" data-bs-toggle="pill" data-bs-target="#educacao" type="button" role="tab">Educação</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="profissional-tab" data-bs-toggle="pill" data-bs-target="#profissional" type="button" role="tab">Profissional</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="conhecimentos-tab" data-bs-toggle="pill" data-bs-target="#conhecimentos" type="button" role="tab">Conhecimentos</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="saude-tab" data-bs-toggle="pill" data-bs-target="#saude" type="button" role="tab">Saúde</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="moradia-tab" data-bs-toggle="pill" data-bs-target="#moradia" type="button" role="tab">Moradia</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="bens-tab" data-bs-toggle="pill" data-bs-target="#bens" type="button" role="tab">Bens</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="assistencia-tab" data-bs-toggle="pill" data-bs-target="#assistencia" type="button" role="tab">Assistência</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="alimentacao-tab" data-bs-toggle="pill" data-bs-target="#alimentacao" type="button" role="tab">Alimentação</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="revisar-tab" data-bs-toggle="pill" data-bs-target="#revisar" type="button" role="tab">Revisar</button>
        </li>
    </ul>

    <div class="tab-content" id="formTabContent">
        <!-- IDENTIFICAÇÃO -->
        <div class="tab-pane fade show active" id="identificacao" role="tabpanel">
            <div class="form-section">
                <h3 class="section-title">Dados de Identificação</h3>
                <div class="row">
                    <div class="col-md-4 mb-3 required-field">
                        <label for="{{ form.primeiro_nome.id_for_label }}" class="form-label">Primeiro Nome</label>
                        {{ form.primeiro_nome }}
                    </div>
                    <div class="col-md-8 mb-3 required-field">
                        <label for="{{ form.sobrenomes.id_for_label }}" class="form-label">Sobrenomes</label>
                        {{ form.sobrenomes }}
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-2 mb-3 required-field">
                        <label for="{{ form.idade.id_for_label }}" class="form-label">Idade</label>
                        {{ form.idade }}
                    </div>
                    <div class="col-md-2 mb-3 required-field">
                        <label for="{{ form.sexo.id_for_label }}" class="form-label">Sexo</label>
                        {{ form.sexo }}
                    </div>
                    <div class="col-md-4 mb-3 required-field">
                        <label for="{{ form.data_nascimento.id_for_label }}" class="form-label">Data de Nascimento</label>
                        {{ form.data_nascimento }}
                    </div>
                    <div class="col-md-4 mb-3 required-field">
                        <label for="{{ form.raca_cor.id_for_label }}" class="form-label">Raça/Cor</label>
                        {{ form.raca_cor }}
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4 mb-3 required-field">
                        <label for="{{ form.cpf.id_for_label }}" class="form-label">CPF</label>
                        {{ form.cpf }}
                    </div>
                    <div class="col-md-4 mb-3 required-field">
                        <label for="{{ form.telefone.id_for_label }}" class="form-label">Telefone</label>
                        {{ form.telefone }}
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="form-check mt-4">
                            {{ form.possui_whatsapp }}
                            <label for="{{ form.possui_whatsapp.id_for_label }}" class="form-check-label">Possui WhatsApp?</label>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4 mb-3 required-field">
                        <label for="{{ form.estado_civil.id_for_label }}" class="form-label">Estado Civil</label>
                        {{ form.estado_civil }}
                    </div>
                    <div class="col-md-8 mb-3 required-field">
                        <label for="{{ form.email.id_for_label }}" class="form-label">E-mail</label>
                        {{ form.email }}
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4 mb-3 required-field">
                        <label for="{{ form.turno.id_for_label }}" class="form-label">Turno</label>
                        {{ form.turno }}
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="form-check mt-4">
                            {{ form.apadrinhado }}
                            <label for="{{ form.apadrinhado.id_for_label }}" class="form-check-label">Apadrinhado?</label>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3 required-field">
                        <label for="{{ form.ingressara_projeto.id_for_label }}" class="form-label">Ingressará no Projeto</label>
                        {{ form.ingressara_projeto }}
                    </div>
                </div>
            </div>
            <div class="d-flex justify-content-between">
                <button type="button" class="btn btn-secondary btn-nav" disabled>Anterior</button>
                <button type="button" class="btn btn-primary btn-nav next-tab">Próximo</button>
            </div>
        </div>

        <!-- RESPONSÁVEL -->
        <div class="tab-pane fade" id="responsavel" role="tabpanel">
            <div class="form-section">
                <h3 class="section-title">Responsável Legal</h3>
                <div class="row">
                    <div class="col-12 mb-3">
                        <label for="{{ form.responsavel.id_for_label }}" class="form-label">Responsável</label>
                        {{ form.responsavel }}
                    </div>
                </div>
                <div class="row">
                    <div class="col-12">
                        <button type="button" class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#novoResponsavelModal">
                            <i class="fas fa-plus"></i> Cadastrar Novo Responsável
                        </button>
                    </div>
                </div>
            </div>
            <div class="d-flex justify-content-between">
                <button type="button" class="btn btn-secondary btn-nav prev-tab">Anterior</button>
                <button type="button" class="btn btn-primary btn-nav next-tab">Próximo</button>
            </div>
        </div>

        <!-- ENDEREÇO -->
        <div class="tab-pane fade" id="endereco" role="tabpanel">
            <div class="form-section">
                <h3 class="section-title">Endereço</h3>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="{{ form.cidade.id_for_label }}" class="form-label">Cidade</label>
                        {{ form.cidade }}
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="{{ form.estado.id_for_label }}" class="form-label">Estado</label>
                        {{ form.estado }}
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="{{ form.bairro.id_for_label }}" class="form-label">Bairro</label>
                        {{ form.bairro }}
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="{{ form.microrregiao.id_for_label }}" class="form-label">Microrregião</label>
                        {{ form.microrregiao }}
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label for="{{ form.cep.id_for_label }}" class="form-label">CEP</label>
                        {{ form.cep }}
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="{{ form.numero.id_for_label }}" class="form-label">Número</label>
                        {{ form.numero }}
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="{{ form.complemento.id_for_label }}" class="form-label">Complemento</label>
                        {{ form.complemento }}
                    </div>
                </div>
            </div>
            <div class="d-flex justify-content-between">
                <button type="button" class="btn btn-secondary btn-nav prev-tab">Anterior</button>
                <button type="button" class="btn btn-primary btn-nav next-tab">Próximo</button>
            </div>
        </div>

        <!-- EDUCAÇÃO -->
        <div class="tab-pane fade" id="educacao" role="tabpanel">
            <div class="form-section">
                <h3 class="section-title">Escolaridade</h3>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="{{ form.nivel_escolaridade.id_for_label }}" class="form-label">Nível de Escolaridade</label>
                        {{ form.nivel_escolaridade }}
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="{{ form.tipo_rede_escolar.id_for_label }}" class="form-label">Tipo de Rede Escolar</label>
                        {{ form.tipo_rede_escolar }}
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="{{ form.ano_ou_periodo.id_for_label }}" class="form-label">Ano ou Período</label>
                        {{ form.ano_ou_periodo }}
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="{{ form.turno_escolar.id_for_label }}" class="form-label">Turno Escolar</label>
                        {{ form.turno_escolar }}
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="{{ form.motivo_nao_estuda.id_for_label }}" class="form-label">Motivo por não estudar</label>
                        {{ form.motivo_nao_estuda }}
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="{{ form.deseja_estudar.id_for_label }}" class="form-label">Deseja estudar</label>
                        {{ form.deseja_estudar }}
                    </div>
                </div>
            </div>
            <div class="d-flex justify-content-between">
                <button type="button" class="btn btn-secondary btn-nav prev-tab">Anterior</button>
                <button type="button" class="btn btn-primary btn-nav next-tab">Próximo</button>
            </div>
        </div>

        <!-- PROFISSIONAL -->
        <div class="tab-pane fade" id="profissional" role="tabpanel">
            <div class="form-section">
                <h3 class="section-title">Situação Profissional</h3>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="{{ form.situacao_profissional.id_for_label }}" class="form-label">Situação Profissional</label>
                        {{ form.situacao_profissional }}
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="{{ form.profissao.id_for_label }}" class="form-label">Profissão</label>
                        {{ form.profissao }}
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="{{ form.local_trabalho.id_for_label }}" class="form-label">Local de Trabalho</label>
                        {{ form.local_trabalho }}
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="{{ form.bairro_trabalho.id_for_label }}" class="form-label">Bairro do Trabalho</label>
                        {{ form.bairro_trabalho }}
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="{{ form.salario.id_for_label }}" class="form-label">Salário</label>
                        {{ form.salario }}
                    </div>
                </div>
            </div>
            <div class="d-flex justify-content-between">
                <button type="button" class="btn btn-secondary btn-nav prev-tab">Anterior</button>
                <button type="button" class="btn btn-primary btn-nav next-tab">Próximo</button>
            </div>
        </div>

        <!-- CONHECIMENTOS -->
        <div class="tab-pane fade" id="conhecimentos" role="tabpanel">
            <div class="form-section">
                <h3 class="section-title">Noções Complementares</h3>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="{{ form.conhece_eca.id_for_label }}" class="form-label">Conhece o ECA</label>
                        {{ form.conhece_eca }}
                    </div>
                    <div class="col-md-6 mb-3">
                        <div class="form-check mt-4">
                            {{ form.nocao_direitos_deveres }}
                            <label for="{{ form.nocao_direitos_deveres.id_for_label }}" class="form-check-label">Tem noção de direitos e deveres</label>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="{{ form.referencia_familiar.id_for_label }}" class="form-label">Referência Familiar</label>
                        {{ form.referencia_familiar }}
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="{{ form.conhece_conselho_direito.id_for_label }}" class="form-label">Conhece o Conselho de Direito</label>
                        {{ form.conhece_conselho_direito }}
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="{{ form.qual_conselho.id_for_label }}" class="form-label">Qual Conselho</label>
                        {{ form.qual_conselho }}
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="{{ form.conhece_foscar.id_for_label }}" class="form-label">Conhece o FOSCAR</label>
                        {{ form.conhece_foscar }}
                    </div>
                </div>
            </div>
            <div class="d-flex justify-content-between">
                <button type="button" class="btn btn-secondary btn-nav prev-tab">Anterior</button>
                <button type="button" class="btn btn-primary btn-nav next-tab">Próximo</button>
            </div>
        </div>

        <!-- SAÚDE -->
        <div class="tab-pane fade" id="saude" role="tabpanel">
            <div class="form-section">
                <h3 class="section-title">Situação de Saúde</h3>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <div class="form-check">
                            {{ form.plano_saude }}
                            <label for="{{ form.plano_saude.id_for_label }}" class="form-check-label">Possui plano de saúde</label>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="{{ form.qual_plano_saude.id_for_label }}" class="form-label">Qual plano de saúde</label>
                        {{ form.qual_plano_saude }}
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <div class="form-check">
                            {{ form.teve_problema_saude }}
                            <label for="{{ form.teve_problema_saude.id_for_label }}" class="form-check-label">Teve problema de saúde</label>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="form-check">
                            {{ form.teve_acompanhamento_medico }}
                            <label for="{{ form.teve_acompanhamento_medico.id_for_label }}" class="form-check-label">Teve acompanhamento médico</label>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="form-check">
                            {{ form.ja_fez_cirurgia }}
                            <label for="{{ form.ja_fez_cirurgia.id_for_label }}" class="form-check-label">Já fez cirurgia</label>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12 mb-3">
                        <label for="{{ form.problema_saude_atual.id_for_label }}" class="form-label">Problema de saúde atual</label>
                        {{ form.problema_saude_atual }}
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <div class="form-check">
                            {{ form.deficiencia_fisica }}
                            <label for="{{ form.deficiencia_fisica.id_for_label }}" class="form-check-label">Possui deficiência física</label>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="{{ form.qual_deficiencia.id_for_label }}" class="form-label">Qual deficiência</label>
                        {{ form.qual_deficiencia }}
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="{{ form.condicao_desenvolvimento.id_for_label }}" class="form-label">Condição de desenvolvimento</label>
                        {{ form.condicao_desenvolvimento }}
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="{{ form.local_atendimento_saude.id_for_label }}" class="form-label">Local de atendimento de saúde</label>
                        {{ form.local_atendimento_saude }}
                    </div>
                </div>
            </div>
            <div class="d-flex justify-content-between">
                <button type="button" class="btn btn-secondary btn-nav prev-tab">Anterior</button>
                <button type="button" class="btn btn-primary btn-nav next-tab">Próximo</button>
            </div>
        </div>

        <!-- MORADIA -->
        <div class="tab-pane fade" id="moradia" role="tabpanel">
            <div class="form-section">
                <h3 class="section-title">Moradia e Saneamento</h3>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="{{ form.tipo_casa.id_for_label }}" class="form-label">Tipo de casa</label>
                        {{ form.tipo_casa }}
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="{{ form.material_casa.id_for_label }}" class="form-label">Material da casa</label>
                        {{ form.material_casa }}
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-3 mb-3">
                        <div class="form-check">
                            {{ form.risco_alagamento }}
                            <label for="{{ form.risco_alagamento.id_for_label }}" class="form-check-label">Risco de alagamento</label>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="form-check">
                            {{ form.risco_deslizamento }}
                            <label for="{{ form.risco_deslizamento.id_for_label }}" class="form-check-label">Risco de deslizamento</label>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="{{ form.numero_comodos.id_for_label }}" class="form-label">Número de cômodos</label>
                        {{ form.numero_comodos }}
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <div class="form-check">
                            {{ form.tem_divisoria_criancas_adultos }}
                            <label for="{{ form.tem_divisoria_criancas_adultos.id_for_label }}" class="form-check-label">Tem divisória entre crianças e adultos</label>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="form-check">
                            {{ form.tem_banheiro }}
                            <label for="{{ form.tem_banheiro.id_for_label }}" class="form-check-label">Tem banheiro</label>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="form-check">
                            {{ form.banheiro_dentro_casa }}
                            <label for="{{ form.banheiro_dentro_casa.id_for_label }}" class="form-check-label">Banheiro dentro de casa</label>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <div class="form-check">
                            {{ form.energia_eletrica }}
                            <label for="{{ form.energia_eletrica.id_for_label }}" class="form-check-label">Possui energia elétrica</label>
                        </div>
                    </div>
                    <div class="col-md-8 mb-3">
                        <label for="{{ form.condicoes_agua.id_for_label }}" class="form-label">Condições de água</label>
                        {{ form.condicoes_agua }}
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="{{ form.destino_lixo.id_for_label }}" class="form-label">Destino do lixo</label>
                        {{ form.destino_lixo }}
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="{{ form.destino_fezes.id_for_label }}" class="form-label">Destino de fezes e urina</label>
                        {{ form.destino_fezes }}
                    </div>
                </div>
            </div>
            <div class="d-flex justify-content-between">
                <button type="button" class="btn btn-secondary btn-nav prev-tab">Anterior</button>
                <button type="button" class="btn btn-primary btn-nav next-tab">Próximo</button>
            </div>
        </div>

        <!-- BENS -->
        <div class="tab-pane fade" id="bens" role="tabpanel">
            <div class="form-section">
                <h3 class="section-title">Bens e Equipamentos</h3>
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <div class="form-check">
                            {{ form.possui_radio }}
                            <label for="{{ form.possui_radio.id_for_label }}" class="form-check-label">Possui rádio</label>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="form-check">
                            {{ form.possui_bicicleta }}
                            <label for="{{ form.possui_bicicleta.id_for_label }}" class="form-check-label">Possui bicicleta</label>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="form-check">
                            {{ form.possui_tv }}
                            <label for="{{ form.possui_tv.id_for_label }}" class="form-check-label">Possui TV</label>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <div class="form-check">
                            {{ form.possui_computador }}
                            <label for="{{ form.possui_computador.id_for_label }}" class="form-check-label">Possui computador</label>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="form-check">
                            {{ form.possui_celular }}
                            <label for="{{ form.possui_celular.id_for_label }}" class="form-check-label">Possui celular</label>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="form-check">
                            {{ form.possui_fogao }}
                            <label for="{{ form.possui_fogao.id_for_label }}" class="form-check-label">Possui fogão</label>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <div class="form-check">
                            {{ form.possui_geladeira }}
                            <label for="{{ form.possui_geladeira.id_for_label }}" class="form-check-label">Possui geladeira</label>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="form-check">
                            {{ form.possui_microondas }}
                            <label for="{{ form.possui_microondas.id_for_label }}" class="form-check-label">Possui microondas</label>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="{{ form.equipamentos_estado.id_for_label }}" class="form-label">Estado dos equipamentos</label>
                        {{ form.equipamentos_estado }}
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <div class="form-check">
                            {{ form.equipamentos_recursos_proprios }}
                            <label for="{{ form.equipamentos_recursos_proprios.id_for_label }}" class="form-check-label">Equipamentos adquiridos com recursos próprios</label>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <div class="form-check">
                            {{ form.equipamentos_presenteados }}
                            <label for="{{ form.equipamentos_presenteados.id_for_label }}" class="form-check-label">Equipamentos recebidos como presente</label>
                        </div>
                    </div>
                </div>
            </div>
            <div class="d-flex justify-content-between">
                <button type="button" class="btn btn-secondary btn-nav prev-tab">Anterior</button>
                <button type="button" class="btn btn-primary btn-nav next-tab">Próximo</button>
            </div>
        </div>

        <!-- ASSISTÊNCIA -->
        <div class="tab-pane fade" id="assistencia" role="tabpanel">
            <div class="form-section">
                <h3 class="section-title">Assistência Social e Renda</h3>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <div class="form-check">
                            {{ form.inscrito_cad_unico }}
                            <label for="{{ form.inscrito_cad_unico.id_for_label }}" class="form-check-label">Inscrito no Cadastro Único</label>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <div class="form-check">
                            {{ form.beneficiario_bolsa_familia }}
                            <label for="{{ form.beneficiario_bolsa_familia.id_for_label }}" class="form-check-label">Beneficiário do Bolsa Família</label>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <div class="form-check">
                            {{ form.recebe_auxilio_moradia }}
                            <label for="{{ form.recebe_auxilio_moradia.id_for_label }}" class="form-check-label">Recebe auxílio moradia</label>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <div class="form-check">
                            {{ form.recebe_bpc }}
                            <label for="{{ form.recebe_bpc.id_for_label }}" class="form-check-label">Recebe BPC (Benefício de Prestação Continuada)</label>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="{{ form.renda_familiar.id_for_label }}" class="form-label">Renda familiar</label>
                        {{ form.renda_familiar }}
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="{{ form.renda_per_capita.id_for_label }}" class="form-label">Renda per capita</label>
                        {{ form.renda_per_capita }}
                    </div>
                </div>
            </div>
            <div class="d-flex justify-content-between">
                <button type="button" class="btn btn-secondary btn-nav prev-tab">Anterior</button>
                <button type="button" class="btn btn-primary btn-nav next-tab">Próximo</button>
            </div>
        </div>

        <!-- ALIMENTAÇÃO -->
        <div class="tab-pane fade" id="alimentacao" role="tabpanel">
            <div class="form-section">
                <h3 class="section-title">Hábitos Alimentares e Grupos Comunitários</h3>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="{{ form.habitos_alimentares.id_for_label }}" class="form-label">Hábitos alimentares</label>
                        {{ form.habitos_alimentares }}
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="{{ form.grupos_comunitarios.id_for_label }}" class="form-label">Grupos comunitários</label>
                        {{ form.grupos_comunitarios }}
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label for="{{ form.refeicoes_dia.id_for_label }}" class="form-label">Refeições por dia</label>
                        {{ form.refeicoes_dia }}
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="{{ form.igreja_qual.id_for_label }}" class="form-label">Qual igreja frequenta</label>
                        {{ form.igreja_qual }}
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="{{ form.outro_grupo.id_for_label }}" class="form-label">Outro grupo</label>
                        {{ form.outro_grupo }}
                    </div>
                </div>
            </div>
            <div class="d-flex justify-content-between">
                <button type="button" class="btn btn-secondary btn-nav prev-tab">Anterior</button>
                <button type="button" class="btn btn-primary btn-nav next-tab">Próximo</button>
            </div>
        </div>

        <!-- REVISAR -->
        <div class="tab-pane fade" id="revisar" role="tabpanel">
            <div class="form-section">
                <h3 class="section-title">Revisar e Confirmar</h3>
                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i> Por favor, verifique todas as informações antes de salvar. Após a confirmação, os dados serão registrados no sistema.
                </div>
                
                <div class="row mt-4">
                    <div class="col-md-6">
                        <h5>Identificação</h5>
                        <p><strong>Nome:</strong> <span id="review-nome"></span></p>
                        <p><strong>CPF:</strong> <span id="review-cpf"></span></p>
                        <p><strong>Email:</strong> <span id="review-email"></span></p>
                    </div>
                    <div class="col-md-6">
                        <h5>Endereço</h5>
                        <p><strong>Cidade/Estado:</strong> <span id="review-cidade-estado"></span></p>
                        <p><strong>Bairro:</strong> <span id="review-bairro"></span></p>
                    </div>
                </div>
                
                <div class="row mt-3">
                    <div class="col-12 text-center">
                        <button type="submit" class="btn btn-success btn-lg">
                            <i class="fas fa-save"></i> Salvar Aluno
                        </button>
                    </div>
                </div>
            </div>
            <div class="d-flex justify-content-between">
                <button type="button" class="btn btn-secondary btn-nav prev-tab">Anterior</button>
                <button type="button" class="btn btn-secondary btn-nav" disabled>Próximo</button>
            </div>
        </div>
    </div>
</form>

<!-- Modal para Novo Responsável -->
<div class="modal fade" id="novoResponsavelModal" tabindex="-1" aria-labelledby="novoResponsavelModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="novoResponsavelModalLabel">Cadastrar Novo Responsável</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="responsavelForm">
                    <div class="row">
                        <div class="col-md-12 mb-3">
                            <label for="resp-nome" class="form-label">Nome Completo</label>
                            <input type="text" class="form-control" id="resp-nome" required>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="resp-data-nascimento" class="form-label">Data de Nascimento</label>
                            <input type="date" class="form-control" id="resp-data-nascimento">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="resp-sexo" class="form-label">Sexo</label>
                            <select class="form-control" id="resp-sexo">
                                <option value="">Selecione</option>
                                <option value="M">Masculino</option>
                                <option value="F">Feminino</option>
                            </select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="resp-cpf" class="form-label">CPF</label>
                            <input type="text" class="form-control" id="resp-cpf">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="resp-telefone" class="form-label">Telefone</label>
                            <input type="text" class="form-control" id="resp-telefone">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="resp-whatsapp">
                                <label class="form-check-label" for="resp-whatsapp">
                                    Possui WhatsApp
                                </label>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="resp-estado-civil" class="form-label">Estado Civil</label>
                            <select class="form-control" id="resp-estado-civil">
                                <option value="">Selecione</option>
                                <option value="SOLTEIRO">Solteiro(a)</option>
                                <option value="CASADO">Casado(a)</option>
                                <option value="DIVORCIADO">Divorciado(a)</option>
                                <option value="VIUVO">Viúvo(a)</option>
                            </select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12 mb-3">
                            <label for="resp-email" class="form-label">Email</label>
                            <input type="email" class="form-control" id="resp-email">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" id="saveResponsavel">Salvar Responsável</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.14.0-beta3/dist/js/bootstrap-select.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Adicionar classes Bootstrap aos campos do formulário
        const inputs = document.querySelectorAll('input, select, textarea');
        inputs.forEach(input => {
            if (input.type !== 'checkbox' && input.type !== 'radio') {
                input.classList.add('form-control');
            } else {
                input.classList.add('form-check-input');
            }
        });

        // Navegação entre abas
        const nextButtons = document.querySelectorAll('.next-tab');
        nextButtons.forEach(button => {
            button.addEventListener('click', function() {
                const activeTab = document.querySelector('.tab-pane.active');
                const activeTabId = activeTab.getAttribute('id');
                const nextTab = document.querySelector(`#formTabs button[data-bs-target="#${activeTabId}"]`).parentElement.nextElementSibling.querySelector('button');
                nextTab.click();
            });
        });

        const prevButtons = document.querySelectorAll('.prev-tab');
        prevButtons.forEach(button => {
            button.addEventListener('click', function() {
                const activeTab = document.querySelector('.tab-pane.active');
                const activeTabId = activeTab.getAttribute('id');
                const prevTab = document.querySelector(`#formTabs button[data-bs-target="#${activeTabId}"]`).parentElement.previousElementSibling.querySelector('button');
                prevTab.click();
            });
        });

        // Mostrar/ocultar campos condicionais
        function toggleConditionalFields() {
            // Exemplo: mostrar campo de plano de saúde apenas se tiver plano
            const planoSaude = document.getElementById('{{ form.plano_saude.id_for_label }}');
            const qualPlanoSaude = document.getElementById('{{ form.qual_plano_saude.id_for_label }}').closest('.col-md-6');
            
            if (planoSaude) {
                planoSaude.addEventListener('change', function() {
                    qualPlanoSaude.style.display = this.checked ? 'block' : 'none';
                });
                // Inicializa
                qualPlanoSaude.style.display = planoSaude.checked ? 'block' : 'none';
            }

            // Adicione mais lógica condicional conforme necessário
            // ...
        }
        
        toggleConditionalFields();

        // Preencher dados para revisão antes de enviar
        const checkReviewData = function() {
            const primeiroNome = document.getElementById('{{ form.primeiro_nome.id_for_label }}').value;
            const sobrenomes = document.getElementById('{{ form.sobrenomes.id_for_label }}').value;
            document.getElementById('review-nome').textContent = primeiroNome + ' ' + sobrenomes;
            
            const cpf = document.getElementById('{{ form.cpf.id_for_label }}').value;
            document.getElementById('review-cpf').textContent = cpf;
            
            const email = document.getElementById('{{ form.email.id_for_label }}').value;
            document.getElementById('review-email').textContent = email;
            
            const cidade = document.getElementById('{{ form.cidade.id_for_label }}').value;
            const estado = document.getElementById('{{ form.estado.id_for_label }}').value;
            document.getElementById('review-cidade-estado').textContent = cidade + '/' + estado;
            
            const bairro = document.getElementById('{{ form.bairro.id_for_label }}').value;
            document.getElementById('review-bairro').textContent = bairro;
        };

        document.getElementById('revisar-tab').addEventListener('click', checkReviewData);

        // Mascarar campos de entrada
        function setupMasks() {
            // Se você tiver a biblioteca jQuery mask plugin, poderia usar assim:
            /*
            $('#{{ form.cpf.id_for_label }}').mask('000.000.000-00');
            $('#{{ form.telefone.id_for_label }}').mask('(00) 00000-0000');
            $('#{{ form.cep.id_for_label }}').mask('00000-000');
            */
        }
        
        setupMasks();

        // Validação do formulário
        const form = document.getElementById('alunoForm');
        form.addEventListener('submit', function(event) {
            if (!form.checkValidity()) {
                event.preventDefault();
                event.stopPropagation();
                
                // Encontrar a primeira aba com erro
                const invalidFields = form.querySelectorAll(':invalid');
                if (invalidFields.length > 0) {
                    const firstInvalidField = invalidFields[0];
                    const tabPane = firstInvalidField.closest('.tab-pane');
                    const tabId = tabPane.getAttribute('id');
                    const tab = document.querySelector(`button[data-bs-target="#${tabId}"]`);
                    tab.click();
                    firstInvalidField.focus();
                }
            }
            form.classList.add('was-validated');
        });
        
        // Lógica para adicionar novo responsável
        document.getElementById('saveResponsavel').addEventListener('click', function() {
            const responsavelForm = document.getElementById('responsavelForm');
            
            if (!responsavelForm.checkValidity()) {
                return;
            }
            
            // Aqui você implementaria a lógica para salvar o responsável via AJAX
            // e atualizar o select de responsáveis
            alert('Responsável salvo com sucesso!');
            
            // Fechar o modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('novoResponsavelModal'));
            modal.hide();
        });
    });
</script>
{% endblock %}